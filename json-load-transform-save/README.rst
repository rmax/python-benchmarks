==================================
JSON Load-Transform-Save benchmark
==================================

For this benchmark we mesuare the time to process JSON records from the 
`Github Archive`_ dataset.

.. contents::

Objective
---------

* Load JSON records from a GZIP-compressed file.
* Apply a transformation (i.e.: select only a few fields).
* Store data as JSON in a GZIP-compressed file.

JSON libraries
--------------

* ``json``: Built-in.
* ``ujson``: `UltraJSON`_.
* ``pyrapidjson``: `RapidJSON`_ (third-party bindings).
* ``jq``: `JQ`_ (command line via a pipe).

Compression methods
-------------------

* ``gznaive``: Using ``gzip.open`` built-in function.
* ``gzpiped``: Using ``gzip`` command via a pipe.

System details
--------------

* OSX
* Core i7 processor
* SSD harddrive


Results
-------

.. code::

  ============================= test session starts ==============================
  platform darwin -- Python 2.7.11, pytest-2.9.1, py-1.4.31, pluggy-0.3.1
  benchmark: 3.0.0 (defaults: timer=time.time disable_gc=False min_rounds=5 min_time=5.00us max_time=1.00s calibration_precision=10 warmup=False warmup_iterations=100000)
  rootdir: /Users/rolando/MyProjects/python-benchmarks/json-load-transform-save, inifile: 
  plugins: aspectlib-1.4.2, hypothesis-3.4.0, benchmark-3.0.0
  collected 21 items

  test_bench.py .....................


  ---------------------------------------------------------------------------- benchmark '~05Mb': 7 tests ---------------------------------------------------------------------------
  Name (time in ms)            Min                   Max                  Mean             StdDev                Median                IQR            Outliers(*)  Rounds  Iterations
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  gzpiped_ujson           682.8279 (1.0)        691.8900 (1.0)        686.2360 (1.0)       4.9309 (2.01)       683.9900 (1.0)       6.7965 (1.92)             1;0       3           1
  gzpiped_rapidjson       957.0251 (1.40)       968.0891 (1.40)       963.1418 (1.40)      5.6240 (2.29)       964.3111 (1.41)      8.2980 (2.35)             1;0       3           1
  gzpiped_json          1,825.5520 (2.67)     1,851.8469 (2.68)     1,836.3797 (2.68)     13.7477 (5.61)     1,831.7401 (2.68)     19.7212 (5.58)             1;0       3           1
  gzpiped_jq            1,869.7250 (2.74)     1,883.7750 (2.72)     1,876.4453 (2.73)      7.0448 (2.87)     1,875.8359 (2.74)     10.5375 (2.98)             1;0       3           1
  gznaive_ujson         2,055.3930 (3.01)     2,060.1079 (2.98)     2,057.3643 (3.00)      2.4505 (1.0)      2,056.5920 (3.01)      3.5362 (1.0)              1;0       3           1
  gznaive_rapidjson     2,414.5138 (3.54)     2,424.1779 (3.50)     2,418.0082 (3.52)      5.3587 (2.19)     2,415.3330 (3.53)      7.2480 (2.05)             1;0       3           1
  gznaive_json          3,438.1230 (5.04)     3,476.9049 (5.03)     3,451.7073 (5.03)     21.8440 (8.91)     3,440.0940 (5.03)     29.0864 (8.23)             1;0       3           1
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  ------------------------------------------------------------------- benchmark '~20Mb': 7 tests ------------------------------------------------------------------
  Name (time in s)         Min               Max              Mean            StdDev            Median               IQR            Outliers(*)  Rounds  Iterations
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------
  gzpiped_ujson         1.5018 (1.0)      1.5420 (1.0)      1.5244 (1.0)      0.0206 (3.13)     1.5294 (1.0)      0.0302 (3.15)             1;0       3           1
  gzpiped_rapidjson     2.2022 (1.47)     2.2320 (1.45)     2.2218 (1.46)     0.0169 (2.58)     2.2311 (1.46)     0.0223 (2.33)             1;0       3           1
  gzpiped_json          3.4169 (2.28)     3.4296 (2.22)     3.4241 (2.25)     0.0066 (1.0)      3.4259 (2.24)     0.0096 (1.0)              1;0       3           1
  gzpiped_jq            3.8248 (2.55)     3.8591 (2.50)     3.8391 (2.52)     0.0179 (2.72)     3.8334 (2.51)     0.0257 (2.69)             1;0       3           1
  gznaive_ujson         4.5777 (3.05)     4.6072 (2.99)     4.5929 (3.01)     0.0147 (2.25)     4.5939 (3.00)     0.0221 (2.31)             1;0       3           1
  gznaive_rapidjson     5.4093 (3.60)     5.4772 (3.55)     5.4388 (3.57)     0.0349 (5.31)     5.4299 (3.55)     0.0510 (5.33)             1;0       3           1
  gznaive_json          6.8999 (4.59)     6.9260 (4.49)     6.9118 (4.53)     0.0132 (2.01)     6.9095 (4.52)     0.0196 (2.04)             1;0       3           1
  -----------------------------------------------------------------------------------------------------------------------------------------------------------------

  --------------------------------------------------------------------- benchmark '~90Mb': 7 tests --------------------------------------------------------------------
  Name (time in s)          Min                Max               Mean            StdDev             Median               IQR            Outliers(*)  Rounds  Iterations
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------
  gzpiped_ujson          5.6538 (1.0)       5.7362 (1.0)       5.6832 (1.0)      0.0459 (2.46)      5.6597 (1.0)      0.0618 (2.32)             1;0       3           1
  gzpiped_rapidjson      8.9127 (1.58)      9.6693 (1.69)      9.1900 (1.62)     0.4168 (22.33)     8.9879 (1.59)     0.5675 (21.30)            1;0       3           1
  gzpiped_json          11.8382 (2.09)     12.0577 (2.10)     11.9516 (2.10)     0.1099 (5.89)     11.9588 (2.11)     0.1646 (6.18)             1;0       3           1
  gzpiped_jq            14.3065 (2.53)     14.3420 (2.50)     14.3276 (2.52)     0.0187 (1.0)      14.3342 (2.53)     0.0266 (1.0)              1;0       3           1
  gznaive_ujson         17.3495 (3.07)     17.6452 (3.08)     17.4560 (3.07)     0.1643 (8.80)     17.3733 (3.07)     0.2218 (8.33)             1;0       3           1
  gznaive_rapidjson     20.6600 (3.65)     21.1744 (3.69)     20.8326 (3.67)     0.2960 (15.86)    20.6635 (3.65)     0.3858 (14.48)            1;0       3           1
  gznaive_json          24.7093 (4.37)     24.8151 (4.33)     24.7522 (4.36)     0.0557 (2.98)     24.7323 (4.37)     0.0794 (2.98)             1;0       3           1
  ---------------------------------------------------------------------------------------------------------------------------------------------------------------------

  (*) Outliers: 1 Standard Deviation from Mean; 1.5 IQR (InterQuartile Range) from 1st Quartile and 3rd Quartile.
  ========================= 21 passed in 436.74 seconds ==========================


.. _`Github Archive`: https://www.githubarchive.org/
.. _`UltraJSON`: https://github.com/esnme/ultrajson
.. _`RapidJSON`: https://github.com/hhatto/pyrapidjson
.. _`JQ`: https://github.com/stedolan/jq
